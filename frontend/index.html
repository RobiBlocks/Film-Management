<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>Films und Serien</title>
  </head>

  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 800px;
    }
    th,
    td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #eee;
    }
    img {
      max-width: 200px;
      height: auto;
    }
  </style>

  <body>
    <h1>Filme und Serien</h1>
    <button id="load">Daten laden</button>
    <button id="add">Daten hinzufügen</button>
    <table id="filmTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Bild</th>
          <th>Jahr</th>
          <th>Länge (Minuten)</th>
          <th>Regisseur</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      document.getElementById("load").addEventListener("click", loadFilms);
      document.getElementById("add").addEventListener("click", addNewFilm);

      function loadFilms() {
        fetch("/api/data")
          .then((res) => res.json())
          .then((filme) => {
            const tbody = document.querySelector("#filmTable tbody");
            tbody.innerHTML = "";

            filme.forEach((film) => {
              const tr = document.createElement("tr");

              const tdName = document.createElement("td");
              tdName.textContent = film.Name;
              tr.appendChild(tdName);

              const tdPic = document.createElement("td");
              if (film.Picture) {
                const img = document.createElement("img");
                img.src = "data:image/jpeg;base64," + film.Picture;
                tdPic.appendChild(img);
              } else {
                tdPic.textContent = "kein Bild";
              }
              tr.appendChild(tdPic);

              const tdYear = document.createElement("td");
              tdYear.textContent = film.Year;
              tr.appendChild(tdYear);

              const tdLength = document.createElement("td");
              tdLength.textContent = film.Length;
              tr.appendChild(tdLength);

              const tdDirector = document.createElement("td");
              tdDirector.textContent = film.Director;
              tr.appendChild(tdDirector);

              tbody.appendChild(tr);
            });
          });
      }

      function addNewFilm() {
        const tbody = document.querySelector("#filmTable tbody");
        tbody.innerHTML = "";

        const tr = document.createElement("tr");

        const tdName = document.createElement("td");
        const inputName = document.createElement("input");
        inputName.type = "text";
        inputName.placeholder = "Name";
        tdName.appendChild(inputName);
        tr.appendChild(tdName);

        const tdBild = document.createElement("td");
        const inputBild = document.createElement("input");
        inputBild.type = "file";
        inputBild.placeholder = "Name";
        tdBild.appendChild(inputBild);
        tr.appendChild(tdBild);

        const tdYear = document.createElement("td");
        const inputYear = document.createElement("input");
        inputYear.type = "number";
        inputYear.min = 1900;
        inputYear.max = 2100;
        inputYear.placeholder = "Jahr";
        tdYear.appendChild(inputYear);
        tr.appendChild(tdYear);

        const tdLength = document.createElement("td");
        const inputLength = document.createElement("input");
        inputLength.type = "number";
        inputLength.placeholder = "Länge";
        tdLength.appendChild(inputLength);
        tr.appendChild(tdLength);

        const tdDirector = document.createElement("td");
        const inputDirector = document.createElement("input");
        inputDirector.type = "text";
        inputDirector.placeholder = "Name";
        tdDirector.appendChild(inputDirector);
        tr.appendChild(tdDirector);

        const btnSave = document.createElement("button");
        btnSave.id = "save";
        btnSave.textContent = "Speichern";
        
          btnSave.addEventListener("click", () => {
            const name = inputName.value;
            const jahr = inputYear.value;
            const länge = inputLength.value;
            const regisseur = inputDirector.value;
            const bildDatei = inputBild.files[0];

            saveNewFilm(name, jahr, länge, regisseur, bildDatei);
          });

        tbody.appendChild(tr);
        tbody.appendChild(btnSave);
      }

      function saveNewFilm(inputName, inputYear, inputLength, inputDirector, inputBild) {
        const name = inputName.value;
        const jahr = inputYear.value;
        const länge = inputLength.value;
        const regisseur = inputDirector.value;
        const bildDatei = inputBild.files[0];

        //Code für Speichern neuer Filme
      }
    </script>
  </body>
</html>
